<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-11-29 jue 11:30 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>rasterVis</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Oscar Perpiñán Lamigueiro" />
<meta name="description" content="rasterVis"
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="styles.css" />
<META NAME="viewport" CONTENT="width=device-width, initial-scale=1">
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">rasterVis</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#intro">Introduction</a></li>
<li><a href="#levelplot">Level plots</a></li>
<li><a href="#themes">Themes</a></li>
<li><a href="#factor">Categorical data</a></li>
<li><a href="#scatterplot">Scatterplots and histograms</a></li>
<li><a href="#spacetime">Space-time plots</a></li>
<li><a href="#vectorplot">Vector field plots</a></li>
<li><a href="#interaction">Interaction</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgc7605a1" class="outline-2">
<h2 id="intro"><a id="orgc7605a1"></a>Introduction</h2>
<div class="outline-text-2" id="text-intro">
<p>
The <code>rasterVis</code> package complements the <a href="http://cran.r-project.org/web/packages/raster"><code>raster</code></a> package, providing a
set of methods for enhanced visualization and interaction.  It defines
visualization methods for <a href="#levelplot">quantitative data</a> and <a href="#factor">categorical data</a>, with
<code>levelplot</code>, both for univariate and multivariate rasters.
</p>

<p>
It also includes several methods in the frame of the <a href="#scatterplot">Exploratory Data
Analysis</a> approach: scatterplots with <code>xyplot</code>, histograms and density
plots with <code>histogram</code> and <code>densityplot</code>, violin and boxplots with
<code>bwplot</code>, and a matrix of scatterplots with <code>splom</code>.
</p>

<p>
On the other hand, <code>rasterVis</code> provides three methods to display
<a href="#spacetime">spatiotemporal rasters</a>: <code>hovmoller</code> produces <a href="http://en.wikipedia.org/wiki/Hovm%C3%B6ller_diagram">Hovmöller diagrams</a>,
<code>horizonplot</code> creates <a href="http://www.perceptualedge.com/blog/?p=390">horizon graphs</a>, with many time series displayed
in parallel, and <code>xyplot</code> displays conventional time series plots
extracted from a multilayer raster.
</p>

<p>
Finally, this package is able to display <a href="#vectorplot">vector fields</a> using arrows,
<code>vectorplot</code>, or with streamlines, <code>streamplot</code>.
</p>

<p>
This webpage illustrates some of its functionalities with examples. If
you need more information, you may be interested in my book
&ldquo;<a href="http://oscarperpinan.github.io/bookvis/"><b>Displaying Time Series, Spatial, and Space-Time Data with R</b></a>&rdquo;. It
includes four chapters devoted to the visualization of spatial and
spatiotemporal raster data. Along with the <a href="https://github.com/oscarperpinan/bookvis/tree/master/docs/images">main graphics</a> from the
text, its website offers access to the <a href="https://github.com/oscarperpinan/bookvis/tree/master/data">datasets</a> used in the examples
as well as the <a href="https://github.com/oscarperpinan/bookvis">full R code</a>.
</p>
</div>

<div id="outline-container-org784672a" class="outline-3">
<h3 id="installation"><a id="org784672a"></a>Installation</h3>
<div class="outline-text-3" id="text-installation">
<p>
The stable release of <code>rasterVis</code> can be found at <a href="http://cran.r-project.org/web/packages/rasterVis/">CRAN</a>.  The
development version is at <a href="https://github.com/oscarperpinan/rastervis">GitHub</a>.
</p>

<p>
Install the stable version with:
</p>

<div class="org-src-container">
<pre class="src src-R">install.packages(<span class="org-string">'rasterVis'</span>)
</pre>
</div>

<p>
You can install the development version with the <a href="https://github.com/MangoTheCat/remotes#installation">remotes</a> package:
</p>

<div class="org-src-container">
<pre class="src src-R">remotes::install_github(<span class="org-string">'oscarperpinan/rasterVis'</span>) 
</pre>
</div>

<p>
or with the <a href="https://github.com/hadley/devtools">devtools</a> package:
</p>

<div class="org-src-container">
<pre class="src src-R">devtools::install_github(<span class="org-string">'oscarperpinan/rasterVis'</span>) 
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2d07e98" class="outline-2">
<h2 id="levelplot"><a id="org2d07e98"></a>Level plots</h2>
<div class="outline-text-2" id="text-levelplot">
<p>
This section discusses how to display quantitative data with
<code>levelplot</code> with an example using data from the <a href="http://dx.doi.org/10.5676/EUM_SAF_CM/RAD_MVIRI/V001">CM SAF</a> project, as
described <a href="http://procomun.wordpress.com/2011/06/17/raster-cmsaf-and-solar/">here</a>.
</p>

<div class="org-src-container">
<pre class="src src-R"><span class="org-ess-modifiers">library</span>(raster)
<span class="org-ess-modifiers">library</span>(rasterVis)

<span class="org-comment-delimiter">##</span><span class="org-comment">Solar irradiation data from CMSAF </span>
old <span class="org-ess-assignment">&lt;-</span> setwd(tempdir())
download.file(<span class="org-string">'https://raw.github.com/oscarperpinan/spacetime-vis/master/data/SISmm2008_CMSAF.zip'</span>,
              <span class="org-string">'SISmm2008_CMSAF.zip'</span>, method=<span class="org-string">'wget'</span>)
unzip(<span class="org-string">'SISmm2008_CMSAF.zip'</span>)

listFich <span class="org-ess-assignment">&lt;-</span> dir(pattern=<span class="org-string">'\\.nc'</span>)
stackSIS <span class="org-ess-assignment">&lt;-</span> stack(listFich)
stackSIS <span class="org-ess-assignment">&lt;-</span> stackSIS * 24 <span class="org-comment-delimiter">##</span><span class="org-comment">from irradiance (W/m2) to irradiation Wh/m2</span>

idx <span class="org-ess-assignment">&lt;-</span> seq(as.Date(<span class="org-string">'2008-01-15'</span>), as.Date(<span class="org-string">'2008-12-15'</span>), <span class="org-string">'month'</span>)

SISmm <span class="org-ess-assignment">&lt;-</span> setZ(stackSIS, idx)
names(SISmm) <span class="org-ess-assignment">&lt;-</span> month.abb

setwd(old)
</pre>
</div>

<p>
Once the <code>Rasterstack</code> has been defined, it can be displayed easily
with <code>levelplot</code>. Each panel of the graphic shows a layer of the
<code>RasterStack</code> object using a trellis chart or <a href="http://en.wikipedia.org/wiki/Small_multiple">small-multiple
technique</a>.
</p>

<div class="org-src-container">
<pre class="src src-R">levelplot(SISmm)
</pre>
</div>


<div class="figure">
<p><img src="figs/levelplot.png" alt="levelplot.png" />
</p>
</div>

<p>
If only one layer is chosen, this method displays <a href="http://stackoverflow.com/a/18594679/964866">two marginal plots</a>,
the row and column summaries of the <code>RasterLayer</code>, computed with the
function defined by the component <code>FUN</code> of the list <code>margin</code> (which uses <code>mean</code> as default value):
</p>

<div class="org-src-container">
<pre class="src src-R">levelplot(SISmm, layers = 1, margin = list(FUN = <span class="org-string">'median'</span>), contour=<span class="org-ess-constant">TRUE</span>)
</pre>
</div>


<div class="figure">
<p><img src="figs/levelplot_layer1.png" alt="levelplot_layer1.png" />
</p>
</div>
</div>

<div id="outline-container-org1913bae" class="outline-3">
<h3 id="org1913bae">Overlay plots</h3>
<div class="outline-text-3" id="text-org1913bae">
<p>
The result of the last call is a <code>trellis</code> object. The <a href="http://latticeextra.r-forge.r-project.org/">latticeExtra</a> package
provides the <code>layer</code> function to add contents. For example, let&rsquo;s add the administrative borders. 
This information is available at the <a href="http://www.gadm.org/data/shp/ESP_adm.zip">GADM service</a>.
</p>

<div class="org-src-container">
<pre class="src src-R"><span class="org-ess-modifiers">library</span>(maptools)
proj <span class="org-ess-assignment">&lt;-</span> CRS(<span class="org-string">'+proj=longlat +ellps=WGS84'</span>)
<span class="org-comment-delimiter">##</span><span class="org-comment">Modify next line to your folder</span>
mapaSHP <span class="org-ess-assignment">&lt;-</span> readShapeLines(<span class="org-string">'/home/datos/ESP_adm/ESP_adm2.shp'</span>, proj4string=proj)

p <span class="org-ess-assignment">&lt;-</span> levelplot(SISmm, layers=1, margin = list(FUN = median))
p + layer(sp.lines(mapaSHP, lwd=0.8, col=<span class="org-string">'darkgray'</span>))
</pre>
</div>


<div class="figure">
<p><img src="figs/levelplot_layer_borders.png" alt="levelplot_layer_borders.png" />
</p>
</div>

<p>
A similar approach can be used to overlay several level plots. The solution uses the <code>+.trellis</code> mechanism implemented in <code>latticeExtra</code>. Let&rsquo;s create two different <code>RasterLayer</code> objects:
</p>

<div class="org-src-container">
<pre class="src src-R">f <span class="org-ess-assignment">&lt;-</span> system.file(<span class="org-string">"external/test.grd"</span>, package=<span class="org-string">"raster"</span>)
r <span class="org-ess-assignment">&lt;-</span> raster(f)
r0 <span class="org-ess-assignment">&lt;-</span> init(r, fun = rnorm)
</pre>
</div>

<p>
&#x2026; and create two levelplots with different color palettes:
</p>

<div class="org-src-container">
<pre class="src src-R">p0 <span class="org-ess-assignment">&lt;-</span> levelplot(r0, par.settings = GrTheme)
p1 <span class="org-ess-assignment">&lt;-</span> levelplot(r, par.settings = magmaTheme)
</pre>
</div>

<p>
These plots can be easily combined using <code>+</code> (the first plot sets the color scale):
</p>

<div class="org-src-container">
<pre class="src src-R">p0 + p1
</pre>
</div>


<div class="figure">
<p><img src="figs/levelplot_overlay.png" alt="levelplot_overlay.png" />
</p>
</div>


<p>
The function <code>as.layer</code> with <code>under = TRUE</code> must be used in order to show the other color scale:
</p>

<div class="org-src-container">
<pre class="src src-R">p1 + as.layer(p0, under = <span class="org-ess-constant">TRUE</span>)
</pre>
</div>


<div class="figure">
<p><img src="figs/levelplot_overlay_under.png" alt="levelplot_overlay_under.png" />
</p>
</div>
</div>
</div>


<div id="outline-container-org9925360" class="outline-3">
<h3 id="levelplot_logscale"><a id="org9925360"></a>Log scale</h3>
<div class="outline-text-3" id="text-levelplot_logscale">
<p>
The <code>zscaleLog</code> argument controls whether the object will be log
transformed before being passed to the panel function.  Defaults to
‘NULL’, in which case the Raster* is not transformed.  Other possible
values are any number that works as a base for taking logarithm,
‘TRUE’ (which is equivalent to 10), and ‘&ldquo;e&rdquo;’ (for the natural
logarithm).  As a side effect, the colorkey is labeled differently.
</p>

<div class="org-src-container">
<pre class="src src-R">f <span class="org-ess-assignment">&lt;-</span> system.file(<span class="org-string">"external/test.grd"</span>, package=<span class="org-string">"raster"</span>)
r <span class="org-ess-assignment">&lt;-</span> raster(f)
levelplot(r^2, zscaleLog=<span class="org-ess-constant">TRUE</span>, contour=<span class="org-ess-constant">TRUE</span>)
</pre>
</div>


<div class="figure">
<p><img src="figs/levelplot_logscale.png" alt="levelplot_logscale.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org6a5674f" class="outline-2">
<h2 id="themes"><a id="org6a5674f"></a>Themes</h2>
<div class="outline-text-2" id="text-themes">
<p>
The previous plots used the default theme of rasterVis,
<code>rasterTheme</code>, using the <code>magma</code> palette provided by the <a href="https://github.com/sjmgarnier/viridisLite"><code>viridisLite</code> package</a>. The other palettes provided by this package are available
through the <code>viridisTheme</code>, <code>infernoTheme</code>, and <code>plasmaTheme</code> functions. Besides, <code>YlOrRdTheme</code>, <code>BuRdTheme</code>, <code>RdBuTheme</code>, <code>GrTheme</code>, and <code>BTCTheme</code> are variations of <code>rasterTheme</code> using palettes
of the <code>RColorBrewer</code> and <code>hexbin</code> packages. Let&rsquo;s try them with an example:
</p>

<p>
The irradiation of August is:
</p>

<div class="org-src-container">
<pre class="src src-R">Aug <span class="org-ess-assignment">&lt;-</span> raster(SISmm, 8)
</pre>
</div>

<p>
and its overall mean is calculated with cellStats:
</p>

<div class="org-src-container">
<pre class="src src-R">meanAug <span class="org-ess-assignment">&lt;-</span> cellStats(Aug, mean)
</pre>
</div>

<p>
The <code>RdBuTheme</code> diverging palette is specially well suited to this data:
</p>

<div class="org-src-container">
<pre class="src src-R">levelplot(Aug - meanAug, par.settings = RdBuTheme)
</pre>
</div>


<div class="figure">
<p><img src="figs/levelplotAug.png" alt="levelplotAug.png" />
</p>
</div>

<p>
Besides, it is easy to define a new theme with a different
palette. For example, using a sequential palette from
<a href="http://cran.r-project.org/web/packages/colorspace">colorspace</a>:
</p>

<div class="org-src-container">
<pre class="src src-R"><span class="org-ess-modifiers">library</span>(colorspace)
myTheme <span class="org-ess-assignment">&lt;-</span> rasterTheme(region=sequential_hcl(10, power=2.2))
levelplot(Aug, par.settings = myTheme, contour = <span class="org-ess-constant">TRUE</span>)
</pre>
</div>


<div class="figure">
<p><img src="figs/levelplot_colorspace.png" alt="levelplot_colorspace.png" />
</p>
</div>

<p>
or with the colour-blindness corrections from the <a href="http://cran.r-project.org/web/packages/dichromat/">dichromat</a> package:
</p>

<div class="org-src-container">
<pre class="src src-R"><span class="org-ess-modifiers">library</span>(dichromat)
myTheme <span class="org-ess-assignment">&lt;-</span> rasterTheme(region = dichromat(terrain.colors(15)))
levelplot(Aug, par.settings = myTheme)
</pre>
</div>


<div class="figure">
<p><img src="figs/levelplot_dichromat.png" alt="levelplot_dichromat.png" />
</p>
</div>
</div>
</div>


<div id="outline-container-org3da5daf" class="outline-2">
<h2 id="factor"><a id="org3da5daf"></a>Categorical data</h2>
<div class="outline-text-2" id="text-factor">
<p>
A raster that contains categorical data can be defined with the <code>ratify</code> function.
</p>
<div class="org-src-container">
<pre class="src src-R">r <span class="org-ess-assignment">&lt;-</span> raster(nrow=10, ncol=10)
r[] = 1
r[51:100] = 3
r[3:6, 1:5] = 5
r <span class="org-ess-assignment">&lt;-</span> ratify(r)
</pre>
</div>

<p>
The levels are stored in the &ldquo;Raster Attribute Table&rdquo; (RAT) that can be manipulated with the <code>levels</code> function:
</p>
<div class="org-src-container">
<pre class="src src-R">rat <span class="org-ess-assignment">&lt;-</span> levels(r)[[1]]
rat$landcover <span class="org-ess-assignment">&lt;-</span> c(<span class="org-string">'Pine'</span>, <span class="org-string">'Oak'</span>, <span class="org-string">'Meadow'</span>)
rat$class <span class="org-ess-assignment">&lt;-</span> c(<span class="org-string">'A1'</span>, <span class="org-string">'B2'</span>, <span class="org-string">'C3'</span>)
levels(r) <span class="org-ess-assignment">&lt;-</span> rat
</pre>
</div>

<p>
Such type of rasters are easily displayed with <code>levelplot</code>:
</p>
<div class="org-src-container">
<pre class="src src-R">levelplot(r, col.regions=c(<span class="org-string">'palegreen'</span>, <span class="org-string">'midnightblue'</span>, <span class="org-string">'indianred1'</span>))
</pre>
</div>


<div class="figure">
<p><img src="figs/levels.png" alt="levels.png" />
</p>
</div>

<p>
You can choose the variable (column) from the RAT with the <code>att</code> argument:
</p>
<div class="org-src-container">
<pre class="src src-R">levelplot(r, att=<span class="org-string">'class'</span>, col.regions=c(<span class="org-string">'palegreen'</span>, <span class="org-string">'midnightblue'</span>, <span class="org-string">'indianred1'</span>))
</pre>
</div>


<div class="figure">
<p><img src="figs/levelsAtt.png" alt="levelsAtt.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org5d08521" class="outline-2">
<h2 id="scatterplot"><a id="org5d08521"></a>Scatterplots and histograms</h2>
<div class="outline-text-2" id="text-scatterplot">
<p>
There are methods to show scatter plots and hexbin plots of the layers
and coordinates of a <code>Raster</code> object:
</p>

<div class="org-src-container">
<pre class="src src-R">  <span class="org-comment-delimiter">##</span><span class="org-comment">Relation between the January &amp; February versus July radiation for four</span>
  <span class="org-comment-delimiter">##</span><span class="org-comment">differents longitude regions.</span>
  xyplot(Jan+Feb~Jul|cut(x, 4), data = SISmm, auto.key = list(space=<span class="org-string">'right'</span>))
</pre>
</div>


<div class="figure">
<p><img src="figs/xyplot_formula.png" alt="xyplot_formula.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-R">  <span class="org-comment-delimiter">##</span><span class="org-comment">Faster with hexbinplot</span>
  hexbinplot(Jan~Jul|cut(x, 6), data = SISmm)
</pre>
</div>


<div class="figure">
<p><img src="figs/hexbinplot_formula.png" alt="hexbinplot_formula.png" />
</p>
</div>


<p>
&#x2026;a method for scatter plot matrices:
</p>

<div class="org-src-container">
<pre class="src src-R">splom(SISmm)
</pre>
</div>


<div class="figure">
<p><img src="figs/splom.png" alt="splom.png" />
</p>
</div>

<p>
..and methods for histograms, <a href="http://procomun.wordpress.com/2011/04/02/violin-plot/">box-and-whisker and violin</a> plots or density estimates:
</p>

<div class="org-src-container">
<pre class="src src-R">histogram(SISmm)
</pre>
</div>


<div class="figure">
<p><img src="figs/histogram.png" alt="histogram.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-R">densityplot(SISmm)
</pre>
</div>


<div class="figure">
<p><img src="figs/density.png" alt="density.png" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-R">bwplot(SISmm)
</pre>
</div>


<div class="figure">
<p><img src="figs/bwplot.png" alt="bwplot.png" />
</p>
</div>

<p>
These methods accept a <code>FUN</code> argument to be applied to the <code>z</code> slot of
the <code>Raster</code> object. The result of this function is used as the grouping
variable of the plot:
</p>

<div class="org-src-container">
<pre class="src src-R">histogram(SISmm, FUN = as.yearqtr)
</pre>
</div>


<div class="figure">
<p><img src="figs/histogram_FUN.png" alt="histogram_FUN.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgc2c6cb8" class="outline-2">
<h2 id="spacetime"><a id="orgc2c6cb8"></a>Space-time plots</h2>
<div class="outline-text-2" id="text-spacetime">
<p>
The <code>z</code> slot of this <code>Raster</code> object stores a time index. This 3D
space-time <code>Raster</code> object can be displayed with a <a href="http://en.wikipedia.org/wiki/Hovmoller_diagram">hovmoller diagram</a>.
</p>

<p>
The <code>hovmoller</code> method uses the function <code>xyLayer</code>, which creates a
<code>RasterLayer</code> from a function of the coordinates.
</p>

<div class="org-src-container">
<pre class="src src-R">f <span class="org-ess-assignment">&lt;-</span> system.file(<span class="org-string">"external/test.grd"</span>, package = <span class="org-string">"raster"</span>)
r <span class="org-ess-assignment">&lt;-</span> raster(f)
dirXY <span class="org-ess-assignment">&lt;-</span> xyLayer(r, sqrt(x^2 + y^2))
dirXY
</pre>
</div>

<p>
For example, the next code builds a hovmoller diagram showing the time evolution of the anomalies of Sea Surface Temperature data available from the Climate Analysis Center (<a href="http://iridl.ldeo.columbia.edu/SOURCES/.CAC/">more information here</a>):
</p>

<div class="org-src-container">
<pre class="src src-R"><span class="org-ess-modifiers">library</span>(zoo)

old <span class="org-ess-assignment">&lt;-</span> setwd(tempdir())
download.file(<span class="org-string">'http://iridl.ldeo.columbia.edu/SOURCES/.CAC/.sst/data.nc'</span>, 
destfile = <span class="org-string">'SST.nc'</span>)
SST <span class="org-ess-assignment">&lt;-</span> stack(<span class="org-string">'SST.nc'</span>)
idx <span class="org-ess-assignment">&lt;-</span> seq(as.Date(<span class="org-string">'1970-01-01'</span>), as.Date(<span class="org-string">'2003-03-01'</span>), by=<span class="org-string">'month'</span>)
tt <span class="org-ess-assignment">&lt;-</span> as.yearmon(idx)
SST <span class="org-ess-assignment">&lt;-</span> setZ(SST, tt)
names(SST) <span class="org-ess-assignment">&lt;-</span> as.character(tt)

<span class="org-comment-delimiter">## </span><span class="org-comment">Extract month value from a Date or yearmon object</span>
<span class="org-function-name">month</span> <span class="org-ess-assignment">&lt;-</span> <span class="org-ess-keyword">function</span>(x)format(x, <span class="org-string">'%m'</span>)
<span class="org-comment-delimiter">## </span><span class="org-comment">Compute anomaly using monthly grouping with ave  </span>
<span class="org-function-name">anomaly</span> <span class="org-ess-assignment">&lt;-</span> <span class="org-ess-keyword">function</span>(x){
    <span class="org-comment-delimiter">## </span><span class="org-comment">Monthly means</span>
    mm <span class="org-ess-assignment">&lt;-</span> ave(x, month(tt), FUN = mean)
    <span class="org-comment-delimiter">## </span><span class="org-comment">Monthly standard deviation</span>
    msd <span class="org-ess-assignment">&lt;-</span> ave(x, month(tt), FUN = sd)
    <span class="org-comment-delimiter">## </span><span class="org-comment">anomaly</span>
    (x - mm)/msd
}

<span class="org-comment-delimiter">## </span><span class="org-comment">Use anomaly with calc</span>
SSTanom <span class="org-ess-assignment">&lt;-</span> calc(SST, anomaly)
SSTanom <span class="org-ess-assignment">&lt;-</span> setZ(SSTanom, tt)
setwd(old)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span class="org-comment-delimiter">## </span><span class="org-comment">Ok, let's see the result</span>
hovmoller(SSTanom,
          at = seq(-3, 3, .25),
          panel = panel.levelplot.raster,
          interpolate = <span class="org-ess-constant">TRUE</span>,
          yscale.components = yscale.raster.subticks,
          par.settings = BuRdTheme)
</pre>
</div>


<div class="figure">
<p><img src="figs/hovmoller.png" alt="hovmoller.png" />
</p>
</div>

<p>
The <code>horizonplot</code> and <code>xyplot</code> methods also are useful for the space-time <code>Raster</code> objects:
</p>

<div class="org-src-container">
<pre class="src src-R">horizonplot(SSTanom,
            col.regions = rev(brewer.pal(n = 10, <span class="org-string">'RdBu'</span>)))
</pre>
</div>


<div class="figure">
<p><img src="figs/horizon.png" alt="horizon.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org6c925c4" class="outline-2">
<h2 id="vectorplot"><a id="org6c925c4"></a>Vector field plots</h2>
<div class="outline-text-2" id="text-vectorplot">
<p>
The function <code>terrain</code> from <code>raster</code> provides the vector field
(gradient) from a scalar field stored in a <code>RasterLayer</code> object. The
magnitude (slope) and direction (aspect) of the vector field is
usually displayed with a set of arrows (e.g. <code>quiver</code> in Matlab).
</p>

<p>
<code>rasterVis</code> includes a method, <code>vectorplot</code>, to calculate and display
this vector field. 
</p>

<div class="org-src-container">
<pre class="src src-R">proj <span class="org-ess-assignment">&lt;-</span> CRS(<span class="org-string">'+proj=longlat +datum=WGS84'</span>)
df <span class="org-ess-assignment">&lt;-</span> expand.grid(x = seq(-2, 2, .01), y = seq(-2, 2, .01))
  
df$z <span class="org-ess-assignment">&lt;-</span> with(df, (3*x^2 + y)*exp(-x^2-y^2))
r <span class="org-ess-assignment">&lt;-</span> rasterFromXYZ(df, crs=proj)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">vectorplot(r, par.settings=RdBuTheme())
</pre>
</div>


<div class="figure">
<p><img src="figs/vectorplot.png" alt="vectorplot.png" />
</p>
</div>

<p>
If the <code>Raster*</code> object passed to <code>vectorplot</code> is a
vector field (<code>isField=TRUE</code>), the <code>terrain</code> calculation is
skipped.
</p>

<p>
An alternative method to display a vector field plots streamlines
along the field lines. Streamlines, a family of curves that are
tangent to the vector field, show the direction an element
(<i>droplet</i>) will follow under the effect of the field.
<code>streamplot</code> displays streamlines with a procedure inspired
by the <a href="http://christl.cg.tuwien.ac.at/research/vis/dynsys/frolic/frolic_crc.pdf">FROLIC algorithm</a>: for each point
(<i>droplet</i>) of a jittered regular grid, a short streamline
portion (<i>streamlet</i>) is calculated by integrating the
underlying vector field at that point. The main color of each
streamlet indicates local vector magnitude
(<code>slope</code>). Besides, streamlets are composed of points whose sizes,
positions and color degradation encode the local vector direction
(<code>aspect</code>).
</p>

<div class="org-src-container">
<pre class="src src-R">streamplot(r)
</pre>
</div>


<div class="figure">
<p><img src="figs/streamplot.png" alt="streamplot.png" />
</p>
</div>

<p>
<code>streamplot</code> accepts two arguments (<code>droplets</code> and <code>streamlets</code>)
to control the number of droplets, the length of the streamlets
and the streamlet calculation step. The streamlet colour
palette and the panel background color are defined with an
specific theme for <code>streamplot</code>, <code>streamTheme</code>. The default
options can be changed easily:
</p>

<div class="org-src-container">
<pre class="src src-R">df$z <span class="org-ess-assignment">&lt;-</span> with(df, sqrt(x^2 + y^2))
df$phi <span class="org-ess-assignment">&lt;-</span> with(df, atan2(-y, x))
r2 <span class="org-ess-assignment">&lt;-</span> rasterFromXYZ(df, crs=proj)
  
streamplot(r2, isField=<span class="org-ess-constant">TRUE</span>, streamlet=list(L=30), droplet=list(pc=.3),
           par.settings=streamTheme(symbol=brewer.pal(n=5, name=<span class="org-string">'Reds'</span>)))
  
</pre>
</div>


<div class="figure">
<p><img src="figs/streamplotReds.png" alt="streamplotReds.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgccecdf6" class="outline-2">
<h2 id="interaction"><a id="orgccecdf6"></a>Interaction</h2>
<div class="outline-text-2" id="text-interaction">
<p>
This package includes two functions to interact with the <code>trellis</code> objects. 
</p>

<p>
The <code>identifyRaster</code> method labels and returns points of a trellis graphic
according to mouse clicks. It is commonly used after <code>levelplot</code>,
although it can be also used after <code>xyplot</code>, <code>hexbinplot</code> or even <code>splom</code>:
</p>

<div class="org-src-container">
<pre class="src src-R">levelplot(SISmm)

<span class="org-comment-delimiter">## </span><span class="org-comment">Do not close the last graphical window.  Use the left button of the</span>
<span class="org-comment-delimiter">## </span><span class="org-comment">mouse to identify points and the right button to finish</span>

chosen <span class="org-ess-assignment">&lt;-</span> identifyRaster(SISmm, layer=3, values=<span class="org-ess-constant">TRUE</span>)
</pre>
</div>

<p>
The <code>chooseRegion</code> function provides a set of points (in the form of a
<code>SpatialPoints</code> object) inside a region defined by several mouse
clicks. Use the left button of the mouse to build a border with points, and
the right button to finish.  The points enclosed by the border will
be highlighted and returned as a SpatialPoints object.
</p>

<div class="org-src-container">
<pre class="src src-R">reg <span class="org-ess-assignment">&lt;-</span> chooseRegion()
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p><a href="http://oscarperpinan.github.io/rastervis/FAQ.html">FAQs</a></p><p><a href="https://github.com/oscarperpinan/rastervis">View the Project on GitHub</a></p><p>Maintained by <a href="http://oscarperpinan.github.io/">Oscar Perpiñán</a>.</script></p>
</div>
</body>
</html>
